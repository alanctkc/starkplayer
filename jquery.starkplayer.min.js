(function(a){a.starkplayer_id_counter=0;a.fn.extend({starkplayer:function(c){var f={type:"",url:"",poster:"",youtubeid:"",width:"",height:"",autoplay:"false",buffertime:"10",border:"",bgcolor:"#ffffff",logo:"",quality:"default",videoplayer:"videoplayer.swf",audioplayer:"audioplayer.swf",youtubeplayer:"youtubeplayer.swf"};var c=a.extend(f,c);function d(h){var h=h.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var i=a("<div></div>").get(0);i.innerHTML='<a href="'+h+'">link</a>';return i.firstChild.href}function e(i,k,l,o){var h=i.tagName;var n=i.nextSibling;var m=a("<div></div>");while(n&&n.tagName!==l&&n.tagName!==h){if(n.tagName=="SOURCE"){n=b(n,o).get(0)}a(n).clone().appendTo(m);var j=n.nextSibling;a(n).remove();n=j}if(n&&n.tagName==l){a(n).remove()}a.each(i.attributes,function(p,q){a(m).attr(q.name,q.value)});m.addClass(k).insertAfter(i);a(i).remove();return m}function b(h,j){var i=a("<span></span>");a.each(h.attributes,function(k,l){i.attr(l.name,l.value)});i.addClass(j).insertAfter(h);a(h).remove();return i}var g=false;a("*").each(function(){if(this.tagName=="/AUDIO"){g=true}if(this.tagName=="/VIDEO"){g=true}});return this.each(function(){var k=a.extend({},c);var n=a(this);if(parseInt(swfobject.getFlashPlayerVersion()["major"])<10){n.show();return}if(g){if(n.get(0).tagName=="AUDIO"){n=e(this,"html5-audio","/AUDIO","html5-source")}if(n.get(0).tagName=="VIDEO"){n=e(this,"html5-video","/VIDEO","html5-source")}}n.hide();var j=a("<div></div>").attr("id","starkplayer-"+a.starkplayer_id_counter);n.wrap(j);a.starkplayer_id_counter++;if(k.url==""&&(n.get(0).tagName=="AUDIO"||n.hasClass("html5-audio"))){if(n.attr("src")){k.url=d(n.attr("src"))}else{var i=n.find("source, .html5-source");if(i.length>0){var h=i.first();if(h.attr("src")){k.url=d(h.attr("src"))}}}if(k.type==""){k.type="audio"}}if(k.url==""&&(n.get(0).tagName=="VIDEO"||n.hasClass("html5-video"))){if(k.poster==""&&n.attr("poster")){k.poster=d(n.attr("poster"))}if(n.attr("src")){k.url=d(n.attr("src"))}else{var i=n.find("source, .html5-source");if(i.length>0){var h=i.first();if(h.attr("src")){k.url=d(h.attr("src"))}}}if(k.width==""&&n.attr("width")){k.width=n.attr("width")}if(k.height==""&&n.attr("height")){k.height=n.attr("height")}if(k.type==""){k.type="video"}}if(k.url==""&&n.get(0).tagName=="A"){if(n.attr("href")){k.url=d(n.attr("href"))}var q=n.find("img");if(q.length>0){var p=q.first();if(k.poster==""&&p.attr("src")){k.poster=d(p.attr("src"))}}}if(k.url==""&&n.get(0).tagName=="IFRAME"){if(n.attr("src")){k.url=d(n.attr("src"))}if(k.width==""&&n.attr("width")){k.width=n.attr("width")}if(k.height==""&&n.attr("height")){k.height=n.attr("height")}}if(k.type==""&&k.url!==""){var l=/[^\?\#]*\.(.*?)((\?|\#)+?.*)*$/i.exec(k.url)[1];if(k.url.match(/^http\:\/\/(www\.){0,1}youtube\.com\//)){k.type="youtube"}else{if(l=="mp4"||l=="m4v"||l=="flv"||l=="mpg"||l=="mpeg"||l=="mov"||l=="3gp"){k.type="video"}else{if(l=="mp3"){k.type="audio"}}}}if(k.youtubeid==""&&k.url!==""&&k.type=="youtube"){k.youtubeid=/.*(\/embed\/|\/v\/|[\?\&\#\!]v\=)([a-zA-Z0-9\_]*).*$/i.exec(k.url)[2]}if(k.type=="audio"){if(k.width==""){k.width="260"}if(k.height==""){k.height="30"}}n.bind("starkplayer.ready",function(){if(k.type!==""&&(k.type!=="youtube"&&k.url!==""||(k.type=="youtube"&&k.youtubeid!==""))){var s=a(this).css("display");a(this).css("display","block");if(k.width==""&&(k.type=="video"||k.type=="youtube")){k.width=a(this).width()}if(k.height==""&&(k.type=="video"||k.type=="youtube")){k.height=a(this).height()}a(this).css("display",s);if(k.type=="video"){var r=k.videoplayer;var o={url:k.url,width:k.width,height:k.height,poster:k.poster,autoplay:k.autoplay,buffertime:k.buffertime,border:k.border,logo:k.logo};var t={allowFullScreen:"true",menu:"false"}}else{if(k.type=="audio"){var r=k.audioplayer;var o={url:k.url,autoplay:k.autoplay,border:k.border};var t={menu:"false",bgcolor:k.bgcolor}}else{if(k.type=="youtube"){var r=k.youtubeplayer;var o={id:k.youtubeid,autoplay:k.autoplay,border:k.border,quality:k.quality,logo:k.logo};var t={allowFullScreen:"true",menu:"false"}}}}swfobject.embedSWF(r,j.attr("id"),k.width,k.height,"10.0.0",null,o,t,{id:j.attr("id"),name:j.attr("id")});a(this).show()}else{a(this).show()}});if(k.type=="video"&&k.poster!==""&&(k.width==""||k.height=="")){var m=a("<img></img>").attr("src",k.poster);if(m.get(0).complete){if(k.width==""){k.width=this.width}if(k.height==""){k.height=this.height}n.trigger("starkplayer.ready")}else{m.load(function(){if(k.width==""){k.width=this.width}if(k.height==""){k.height=this.height}n.trigger("starkplayer.ready")})}}else{if(k.type=="youtube"&&n.get(0).tagName=="IFRAME"&&n.get(0).document&&n.get(0).document.readyState!=="complete"){n.load(function(){n.trigger("starkplayer.ready")})}else{n.trigger("starkplayer.ready")}}})}})})(jQuery);
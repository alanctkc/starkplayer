(function(a){a.starkplayer_id_counter=0;a.fn.extend({starkplayer:function(b){var e={type:"",url:"",poster:"",youtubeid:"",width:"",height:"",autoplay:"false",buffertime:"10",border:"",bgcolor:"#ffffff",logo:"",quality:"default",videoplayer:"videoplayer.swf",audioplayer:"audioplayer.swf",youtubeplayer:"youtubeplayer.swf"};var b=a.extend(e,b);var d=false;a("*").each(function(){if(this.tagName=="/AUDIO"){d=true}if(this.tagName=="/VIDEO"){d=true}});if(d){var f=0;a("audio").each(function(){var j=false;var i=false;var h=this.nextSibling;var l=a("<div></div>");while(!j&&!i){var k=h;if(k.tagName=="SOURCE"){var g=a("<span></span>");a.each(k.attributes,function(m,n){g.attr(n.name,n.value)});g.addClass("html5-source").insertAfter(k);a(k).remove();k=g.get(0)}if(k.tagName=="/AUDIO"){j=true}else{if(!k){i=true}else{a(k).clone().appendTo(l)}}h=k.nextSibling;a(k).remove()}a.each(this.attributes,function(m,n){a(l).attr(n.name,n.value)});l.addClass("html5-audio").addClass("html5-fix-"+f).insertAfter(this);a(this).attr("rel",".html5-fix-"+f);f++;a(this).remove()});a("video").each(function(){var j=false;var i=false;var h=this.nextSibling;var l=a("<div></div>");while(!j&&!i){var k=h;if(k.tagName=="SOURCE"){var g=a("<span></span>");a.each(k.attributes,function(m,n){g.attr(n.name,n.value)});g.addClass("html5-source").insertAfter(k);a(k).remove();k=g.get(0)}if(k.tagName=="/VIDEO"){j=true}else{if(!k){i=true}else{a(k).clone().appendTo(l)}}h=k.nextSibling;a(k).remove()}a.each(this.attributes,function(m,n){a(l).attr(n.name,n.value)});l.addClass("html5-video").addClass("html5-fix-"+f).insertAfter(this);a(this).attr("rel",".html5-fix-"+f);f++;a(this).remove()})}function c(g){var g=g.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var h=a("<div></div>").get(0);h.innerHTML='<a href="'+g+'">link</a>';return h.firstChild.href}return this.each(function(){var k=a.extend({},b);var m=a(this);if(d&&(m.get(0).tagName=="AUDIO"||m.get(0).tagName=="VIDEO")){m=a(m.attr("rel"))}if(parseInt(swfobject.getFlashPlayerVersion()["major"])<10){m.show();return}var i=a("<div></div>").attr("id","starkplayer-"+a.starkplayer_id_counter);m.wrap(i);a.starkplayer_id_counter++;if(k.url==""&&(m.get(0).tagName=="AUDIO"||m.hasClass("html5-audio"))){if(m.attr("src")){k.url=c(m.attr("src"))}else{var h=m.find("source, .html5-source");if(h.length>0){var g=h.first();if(g.attr("src")){k.url=c(g.attr("src"))}}}if(k.type==""){k.type="audio"}}if(k.url==""&&(m.get(0).tagName=="VIDEO"||m.hasClass("html5-video"))){if(k.poster==""&&m.attr("poster")){k.poster=c(m.attr("poster"))}if(m.attr("src")){k.url=c(m.attr("src"))}else{var h=m.find("source, .html5-source");if(h.length>0){var g=h.first();if(g.attr("src")){k.url=c(g.attr("src"))}}}if(k.width==""&&m.attr("width")){k.width=m.attr("width")}if(k.height==""&&m.attr("height")){k.height=m.attr("height")}if(k.type==""){k.type="video"}}if(k.url==""&&m.get(0).tagName=="A"){if(m.attr("href")){k.url=c(m.attr("href"))}var p=m.find("img");if(p.length>0){var n=p.first();if(k.poster==""&&n.attr("src")){k.poster=c(n.attr("src"))}}}if(k.url==""&&m.get(0).tagName=="IFRAME"){if(m.attr("src")){k.url=c(m.attr("src"))}if(k.width==""&&m.attr("width")){k.width=m.attr("width")}if(k.height==""&&m.attr("height")){k.height=m.attr("height")}}if(k.url==""&&m.get(0).tagName=="OBJECT"){var t=m.children("param");t.each(function(){var o=a(this);if(o.attr("name")=="movie"){k.url=o.attr("value")}});if(k.width==""&&m.attr("width")){k.width=m.attr("width")}if(k.height==""&&m.attr("height")){k.height=m.attr("height")}}if(k.url==""&&m.get(0).tagName=="EMBED"){if(m.attr("src")){k.url=m.attr("src")}if(k.width==""&&m.attr("width")){k.width=m.attr("width")}if(k.height==""&&m.attr("height")){k.height=m.attr("height")}}if(k.type==""&&k.url!==""){var j=/[^\?\#]*\.(.*?)((\?|\#)+?.*)*$/i.exec(k.url)[1];if(k.url.match(/^http\:\/\/(www\.){0,1}youtube\.com\//)){k.type="youtube"}else{if(j=="mp4"||j=="m4v"||j=="flv"||j=="mpg"||j=="mpeg"||j=="mov"||j=="3gp"){k.type="video"}else{if(j=="mp3"){k.type="audio"}}}}if(k.youtubeid==""&&k.url!==""&&k.type=="youtube"){k.youtubeid=/.*(\/embed\/|\/v\/|[\?\&\#\!]v\=)([a-zA-Z0-9\_]*).*$/i.exec(k.url)[2]}if(k.type=="audio"){if(k.width==""){k.width="260"}if(k.height==""){k.height="30"}}var q=m.css("display");m.css("display","block");if(k.width==""){k.width=m.width()}if(k.height==""){k.height=m.height()}m.css("display",q);if(k.type=="video"){var r=k.videoplayer;var s={url:k.url,poster:k.poster,autoplay:k.autoplay,buffertime:k.buffertime,border:k.border,logo:k.logo};var l={allowFullScreen:"true",menu:"false"}}else{if(k.type=="audio"){var r=k.audioplayer;var s={url:k.url,autoplay:k.autoplay,border:k.border};var l={menu:"false",bgcolor:k.bgcolor}}else{if(k.type=="youtube"){var r=k.youtubeplayer;var s={id:k.youtubeid,autoplay:k.autoplay,border:k.border,quality:k.quality,logo:k.logo};var l={allowFullScreen:"true",menu:"false"}}}}if(k.type!==""&&(k.type!=="youtube"||(k.type=="youtube"&k.youtubeid!==""))){swfobject.embedSWF(r,i.attr("id"),k.width,k.height,"10.0.0",null,s,l,{id:i.attr("id"),name:i.attr("id")})}m.show()})}})})(jQuery);
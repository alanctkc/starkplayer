(function(a){a.starkplayer={counter:0};a.fn.extend({starkplayer:function(c){var f={type:"",url:"",poster:"",youtubeid:"",width:"",height:"",autoplay:"false",buffertime:"10",border:"",bgcolor:"#ffffff",logo:"",quality:"default",aspectratio:"maintain",videoplayer:"videoplayer.swf",audioplayer:"audioplayer.swf",youtubeplayer:"youtubeplayer.swf",embed_callback:function(m,k,i,n,j,l,h){k.insertAfter(m);swfobject.embedSWF(i,k.attr("id"),l,h,"10.0.0",null,j,n,{id:k.attr("id"),name:k.attr("id")},function(o){if(o.success){m.remove()}else{k.remove()}})}};var c=a.extend(f,c);function d(h){var h=h.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var i=a("<div></div>").get(0);i.innerHTML='<a href="'+h+'">link</a>';return i.firstChild.href}function e(i,k,l,o){var h=i.tagName;var n=i.nextSibling;var m=a("<div></div>");while(n&&n.tagName!==l&&n.tagName!==h){if(n.tagName=="SOURCE"){n=b(n,o).get(0)}a(n).clone().appendTo(m);var j=n.nextSibling;a(n).remove();n=j}if(n&&n.tagName==l){a(n).remove()}a.each(i.attributes,function(p,q){a(m).attr(q.name,q.value)});m.addClass(k).insertAfter(i);a(i).remove();return m}function b(h,j){var i=a("<span></span>");a.each(h.attributes,function(k,l){i.attr(l.name,l.value)});i.addClass(j).insertAfter(h);a(h).remove();return i}var g=false;a("*").each(function(){if(this.tagName=="/AUDIO"){g=true}if(this.tagName=="/VIDEO"){g=true}});return this.each(function(){var j=a.extend({},c);var m=a(this);if(g){if(m.get(0).tagName=="AUDIO"){m=e(this,"html5-audio","/AUDIO","html5-source")}if(m.get(0).tagName=="VIDEO"){m=e(this,"html5-video","/VIDEO","html5-source")}}m.hide();var n=a("<div></div>").attr("id","starkplayer-"+a.starkplayer.counter);a.starkplayer.counter++;if(j.url==""&&(m.get(0).tagName=="AUDIO"||m.hasClass("html5-audio"))){if(m.attr("src")){j.url=d(m.attr("src"))}else{var i=m.find("source, .html5-source");if(i.length>0){var h=i.first();if(h.attr("src")){j.url=d(h.attr("src"))}}}if(j.type==""){j.type="audio"}}if(j.url==""&&(m.get(0).tagName=="VIDEO"||m.hasClass("html5-video"))){if(j.poster==""&&m.attr("poster")){j.poster=d(m.attr("poster"))}if(m.attr("src")){j.url=d(m.attr("src"))}else{var i=m.find("source, .html5-source");if(i.length>0){var h=i.first();if(h.attr("src")){j.url=d(h.attr("src"))}}}if(j.width==""&&m.attr("width")){j.width=m.attr("width")}if(j.height==""&&m.attr("height")){j.height=m.attr("height")}if(j.type==""){j.type="video"}}if(j.url==""&&m.get(0).tagName=="A"){if(m.attr("href")){j.url=d(m.attr("href"))}var q=m.find("img");if(q.length>0){var p=q.first();if(j.poster==""&&p.attr("src")){j.poster=d(p.attr("src"))}}}if(j.url==""&&m.get(0).tagName=="IFRAME"){if(m.attr("src")){j.url=d(m.attr("src"))}if(j.width==""&&m.attr("width")){j.width=m.attr("width")}if(j.height==""&&m.attr("height")){j.height=m.attr("height")}}if(j.type==""&&j.url!==""){var k=/[^\?\#]*\.(.*?)((\?|\#)+?.*)*$/i.exec(j.url)[1];if(j.url.match(/^http\:\/\/(www\.){0,1}youtube\.com\//)){j.type="youtube"}else{if(k=="mp4"||k=="m4v"||k=="flv"||k=="mpg"||k=="mpeg"||k=="mov"||k=="3gp"){j.type="video"}else{if(k=="mp3"){j.type="audio"}}}}if(j.youtubeid==""&&j.url!==""&&j.type=="youtube"){j.youtubeid=/.*(\/embed\/|\/v\/|[\?\&\#\!]v\=)([a-zA-Z0-9\_\-]*).*$/i.exec(j.url)[2]}if(j.type=="audio"){if(j.width==""){j.width="260"}if(j.height==""){j.height="30"}}m.bind("starkplayer.ready",function(){if(j.type!==""&&(j.type!=="youtube"&&j.url!==""||(j.type=="youtube"&&j.youtubeid!==""))){var s=a(this).css("display");a(this).css("display","block");if(j.width==""&&(j.type=="video"||j.type=="youtube")){j.width=a(this).width()}if(j.height==""&&(j.type=="video"||j.type=="youtube")){j.height=a(this).height()}a(this).css("display",s);if(j.type=="video"){var r=j.videoplayer;var o={url:j.url,width:j.width,height:j.height,poster:j.poster,autoplay:j.autoplay,buffertime:j.buffertime,border:j.border,logo:j.logo,aspectratio:j.aspectratio};var t={allowFullScreen:"true",menu:"false"}}else{if(j.type=="audio"){var r=j.audioplayer;var o={url:j.url,autoplay:j.autoplay,border:j.border};var t={menu:"false",bgcolor:j.bgcolor}}else{if(j.type=="youtube"){var r=j.youtubeplayer;var o={id:j.youtubeid,autoplay:j.autoplay,border:j.border,quality:j.quality,logo:j.logo};var t={allowFullScreen:"true",menu:"false"}}}}j.embed_callback(m,n,r,t,o,j.width,j.height);a(this).show()}else{a(this).show()}});if(j.type=="video"&&j.poster!==""&&(j.width==""||j.height==""||j.width<0||j.height<0)){var l=a("<img></img>").attr("src",j.poster);if(l.get(0).complete&&l.get(0).width>0){if(j.width==""||j.width<0){j.width=l.get(0).width}if(j.height==""||j.height<0){j.height=l.get(0).height}m.trigger("starkplayer.ready")}else{l.load(function(){if(j.width==""||j.width<0){j.width=this.width}if(j.height==""||j.height<0){j.height=this.height}m.trigger("starkplayer.ready")})}}else{if(j.type=="youtube"&&m.get(0).tagName=="IFRAME"&&m.get(0).document&&m.get(0).document.readyState!=="complete"){m.load(function(){m.trigger("starkplayer.ready")})}else{m.trigger("starkplayer.ready")}}})}})})(jQuery);